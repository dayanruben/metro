# Metro Benchmark Scenarios
#
# This file defines benchmark scenarios for comparing Metro and other DI frameworks.
# Scenarios are generic - the script generates different projects for each mode
# and runs the same scenarios against them.
#
# Modes (handled by run_benchmarks.sh):
# - metro: Metro compiler plugin
# - vanilla: Pure Kotlin baseline (no DI)
# - metro_noop: Metro plugin applied but no annotations (measures plugin overhead)
# - dagger_ksp: Dagger with KSP
# - dagger_kapt: Dagger with KAPT
# - kotlin_inject_anvil: kotlin-inject with Anvil

# ====================================
# INCREMENTAL BUILD SCENARIOS
# ====================================
# These scenarios measure incremental compilation performance when files change.
# All modes use the same scenarios - only the underlying project differs.

abi_change {
    title = "ABI Change"
    warm-ups = 3
    iterations = 5

    tasks = [":app:component:compileKotlin"]

    apply-abi-change-to = "core/foundation/src/main/kotlin/dev/zacsweers/metro/benchmark/core/foundation/CommonInterfaces.kt"
}

non_abi_change {
    title = "Non-ABI Change"
    warm-ups = 3
    iterations = 5

    tasks = [":app:component:compileKotlin"]

    apply-non-abi-change-to = "features/auth-feature-10/src/main/kotlin/dev/zacsweers/metro/benchmark/features/authfeature10/AuthFeature10.kt"
}

# ====================================
# PLAIN KOTLIN FILE SCENARIOS (NO DI)
# ====================================
# These measure compilation when changing files that have no DI annotations.
# Helps isolate the overhead of the DI framework vs pure Kotlin compilation.

plain_abi_change {
    title = "Plain Kotlin ABI Change"
    warm-ups = 3
    iterations = 5

    tasks = [":app:component:compileKotlin"]

    apply-abi-change-to = "core/foundation/src/main/kotlin/dev/zacsweers/metro/benchmark/core/foundation/PlainKotlinFile.kt"
}

plain_non_abi_change {
    title = "Plain Kotlin Non-ABI Change"
    warm-ups = 3
    iterations = 5

    tasks = [":app:component:compileKotlin"]

    apply-non-abi-change-to = "core/foundation/src/main/kotlin/dev/zacsweers/metro/benchmark/core/foundation/PlainKotlinFile.kt"
}

# ====================================
# RAW COMPILATION SCENARIOS
# ====================================
# These measure full compilation performance without incremental compilation.
# Different variants for different mode types based on their compilation needs:
#
# - raw_compilation: For Metro/Vanilla/Metro-NOOP (pure compiler plugin, no annotation processing)
# - raw_compilation_ksp: For kotlin-inject-anvil (needs KSP to run)
# - raw_compilation_java: For Dagger KSP/KAPT (generates Java code, needs classes task)

raw_compilation {
    title = "Raw Compilation"
    warm-ups = 3
    iterations = 5

    # Metro/Vanilla/Metro-NOOP: Pure compiler plugin, rerun only app:component tasks (not all modules)
    tasks = [":app:component:compileKotlin"]
    gradle-args = ["--rerun-tasks", "-a"]
}

raw_compilation_ksp {
    title = "Raw Compilation"
    warm-ups = 3
    iterations = 5

    # kotlin-inject-anvil: KSP generates Kotlin, rerun only app:component tasks (not all modules)
    tasks = [":app:component:compileKotlin"]
    gradle-args = ["--rerun-tasks", "-a"]
}

raw_compilation_java {
    title = "Raw Compilation"
    warm-ups = 3
    iterations = 5

    # Dagger KSP/KAPT: Generates Java code, rerun only app:component tasks (not all modules)
    tasks = [":app:component:classes"]
    gradle-args = ["--rerun-tasks", "-a"]
}

# ====================================
# CLEAN BUILD SCENARIOS
# ====================================

clean_build {
    title = "Clean Build"
    warm-ups = 2
    iterations = 3

    tasks = ["assemble"]
    cleanup-tasks = ["clean"]
    clear-build-cache-before = BUILD
}

# ====================================
# USAGE INSTRUCTIONS
# ====================================

# To run benchmarks, use the run_benchmarks.sh script which handles:
# 1. Generating projects for each mode
# 2. Selecting appropriate scenarios for each mode
# 3. Running gradle-profiler with proper output directories
# 4. Generating HTML reports
#
# Examples:
#   ./run_benchmarks.sh all                    # Run all modes
#   ./run_benchmarks.sh all --include-noop     # Include baseline modes
#   ./run_benchmarks.sh metro                  # Run only Metro mode
#   ./run_benchmarks.sh single --ref main      # Run on specific git ref
#
# To generate different project configurations manually:
#   kotlin generate-projects.main.kts --mode metro --count 500
#   kotlin generate-projects.main.kts --mode vanilla --count 500
#   kotlin generate-projects.main.kts --mode metro_noop --count 500
#   kotlin generate-projects.main.kts --mode dagger --processor ksp --count 500
#   kotlin generate-projects.main.kts --mode dagger --processor kapt --count 500
#   kotlin generate-projects.main.kts --mode kotlin-inject-anvil --count 500
